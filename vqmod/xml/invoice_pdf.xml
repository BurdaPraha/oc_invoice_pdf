<modification>
    <id><![CDATA[Invoice to PDF]]></id>
    <version><![CDATA[1.0.1]]></version>
    <vqmver><![CDATA[1.00]]></vqmver>
    <author><![CDATA[BurdaPraha - inspired from: Ruhama IT Solution]]></author>

    <file name="admin/language/cs-cz/cs-cz.php">
        <operation>
            <search position="after"><![CDATA[<?php]]></search>
            <add><![CDATA[$_['button_pdf_invoice']	= 'PDF faktura';]]></add>
        </operation>
    </file>

    <file name="admin/view/template/sale/order_invoice.tpl">
        <operation>
            <search position="replace"><![CDATA[<div style="page-break-after: always;">]]></search>
            <add><![CDATA[]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[foreach ($orders as $order) { ?>]]></search>
            <add><![CDATA[$loop=1;
			foreach ($orders as $order) {
			if ($loop < count($orders)){?>
            <div style="page-break-after: always;">
            <?php }else{?>
            <div>
            <?php }?>
            <?php $loop++;?>]]></add>
        </operation>
    </file>

    <file name="admin/view/template/sale/order_info.tpl">
        <operation>
            <search position="replace"><![CDATA[<a href="<?php echo $invoice; ?>" target="_blank" data-toggle="tooltip" title="<?php echo $button_invoice_print; ?>" class="btn btn-info"><i class="fa fa-print"></i></a>]]></search>
            <add>
                <![CDATA[
                    <a href="<?php echo $invoice; ?>&pdf=true" target="_blank" data-toggle="tooltip" title="<?php echo $button_pdf_invoice; ?>" class="btn btn-success"><i class="fa fa-file-pdf-o"></i></a> <a href="<?php echo $invoice; ?>" target="_blank" data-toggle="tooltip" title="<?php echo $button_invoice_print; ?>" class="btn btn-info"><i class="fa fa-print"></i></a>
                ]]>
            </add>
        </operation>
    </file>

    <file name="admin/view/template/sale/order_list.tpl">
        <operation>
            <search position="after"><![CDATA[<div class="pull-right">]]></search>
            <add>
                <![CDATA[
                    <a data-toggle="tooltip" onclick="$('#form').attr('action', '<?php echo $invoice; ?>&pdf=true'); $('#form').attr('target', '_blank'); $('#form').submit();" class="btn btn-success" title="<?php echo $button_pdf_invoice; ?>">
                    <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                    </a>
                ]]>
            </add>
        </operation>
    </file>

    <file name="admin/controller/sale/order.php">
        <operation>
            <search position="after"><![CDATA[$data['button_invoice_print'] = $this->language->get('button_invoice_print');]]></search>
            <add><![CDATA[$data['button_pdf_invoice'] = $this->language->get('button_pdf_invoice');]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[invoice() {]]></search>
            <add><![CDATA[$pdf = false;]]></add>
        </operation>
        <operation>
            <search position="replace" offset="7"><![CDATA[$orders = array();]]></search>
            <add><![CDATA[

            $orders = array();

            if (isset($this->request->post['selected'])) {

                $orders = $this->request->post['selected'];
                $pdf = (isset($this->request->get['pdf'])) ? true : false;

            } elseif (isset($this->request->get['order_id'])) {

                $orders[] = $this->request->get['order_id'];
                $pdf = (isset($this->request->get['pdf'])) ? true : false;

            }
            ]]>
            </add>
        </operation>
        <operation>
            <search position="after"><![CDATA[$this->response->setOutput($this->load->view('sale/order_invoice', $data));]]></search>
            <add><![CDATA[

                if ($pdf)
                {
                    $order_view = $this->load->view('sale/order_invoice', $data);
                    $pdf_printer = invoice_pdf($order_view, $data);
                    $this->response->setOutput();
                }

            ]]>
            </add>
        </operation>
    </file>

</modification>